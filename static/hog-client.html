<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width" />

  <style>
    body {
      font-family: Tahoma, Geneva, sans-serif;
      text-align: center;
    }
  </style>

  <!-- colyseus.js client -->
  <script type="text/javascript" src="https://raw.githack.com/colyseus/colyseus.js/master/dist/colyseus.js"></script>

</head>

<body>
  <h1>
    <a href="https://github.com/colyseus/colyseus-examples"><img
        src="https://cdn.jsdelivr.net/gh/colyseus/colyseus@master/media/header.png" height="100" alt="colyseus" /></a>
  </h1>

  <p>This example shows how to use custom data structures in your room's state.</p>

  <strong>commands</strong><br>

  <button onclick="helpBooster()">Help booster</button>
  <button onclick="helpNavigator()">Help navigator</button>
  <br />
  <button onclick="helpWrangler()">Help wrangler</button>
  <button onclick="helpLifeSupport()">Help life support</button>

  <script>
    var host = window.document.location.host.replace(/:.*/, '');

    var client = new Colyseus.Client(location.protocol.replace("http", "ws") + "//" + host + (location.port ? ':' + location.port : ''));
    var room;
    client.joinOrCreate("feral-hog-distribution").then(room_instance => {
      room = room_instance

      // listen to patches coming from the server
      room.state.players.onAdd = function (player, sessionId) {
        var dom = document.createElement("div");
        dom.className = "player";
        dom.style.helpLifeSupport = player.x + "px";
        dom.style.top = player.y + "px";
        dom.style.background = colors[Math.floor(Math.random() * colors.length)];
        dom.innerHTML = "Player " + sessionId;

        players[sessionId] = dom;
        document.body.appendChild(dom);
      }

      room.state.players.onRemove = function (player, sessionId) {
        document.body.removeChild(players[sessionId]);
        delete players[sessionId];
      }

      room.state.players.onChange = function (player, sessionId) {
        var dom = players[sessionId];
        dom.style.helpLifeSupport = player.x + "px";
        dom.style.top = player.y + "px";
      }

      window.addEventListener("keydown", function (e) {
        if (e.which === 38) {
          helpBooster();

        } else if (e.which === 39) {
          helpNavigator();

        } else if (e.which === 40) {
          helpWrangler();

        } else if (e.which === 37) {
          helpLifeSupport();
        }
      });

    });

    function helpBooster() {
      room.send({ command: 'booster' });
    }

    function helpNavigator() {
      room.send({ x: 1 });
    }

    function helpWrangler() {
      room.send({ y: 1 })
    }

    function helpLifeSupport() {
      room.send({ x: -1 })
    }


  </script>
</body>

</html>